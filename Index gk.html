<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vanam AI Post Generator</title>
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Load jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- 3. Custom Fonts (Playfair Display for headers, Inter for body) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- 4. Custom Styles (for luxurious background, animations, and V logo) -->
    <style>
      body {
        font-family: "Inter", sans-serif;
        color: #1e293b; /* slate-800 */

        /* Luxurious Gradient Background - NEW Mocha/Pastel Green */
        background-color: #f7fee7; /* Light lime-50 base */
        background-image: linear-gradient(
          135deg,
          #f7fee7 0%,
          #ecfccb 100%
        ); /* Soft lime-50 to lime-100 gradient */
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        overflow-x: hidden; /* Prevent horizontal scroll */
      }

      h1,
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-family: "Playfair Display", serif; /* Elegant font for headers */
      }

      /* Fade-in animation for the main content container */
      .fade-in {
        animation: fadeIn 1s ease-out forwards;
        opacity: 0;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Slide-up and fade-in for output section */
      .slide-up-fade-in {
        animation: slideUpFadeIn 0.7s ease-out forwards;
        opacity: 0;
        transform: translateY(20px);
      }

      @keyframes slideUpFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* NEW Loading Spinner with Logo */
      .spinner-container {
        position: relative;
        width: 48px; /* Increased size */
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .spinner-ring {
        position: absolute;
        border: 4px solid #ecfccb; /* lime-100 */
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border-top-color: #65a30d; /* lime-600 */
        animation: spin 1s ease infinite;
      }

      .spinner-logo {
        width: 24px;
        height: 24px;
        fill: #365314; /* lime-950 */
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Custom scrollbar for textareas */
      textarea::-webkit-scrollbar {
        width: 8px;
      }
      textarea::-webkit-scrollbar-track {
        background: #ecfccb; /* lime-100 */
        border-radius: 10px;
      }
      textarea::-webkit-scrollbar-thumb {
        background: #a3e635; /* lime-300 */
        border-radius: 10px;
      }
      textarea::-webkit-scrollbar-thumb:hover {
        background: #84cc16; /* lime-500 */
      }

      /* V Logo Hover Effect */
      .v-logo {
        transition: transform 0.3s ease-in-out;
      }
      .v-logo:hover {
        transform: scale(1.1) rotate(5deg);
      }
    </style>
  </head>

  <body class="antialiased">
    <!-- V Logo - Top Left -->
    <div class="absolute top-6 left-6 z-20">
      <!-- NEW V Logo SVG -->
      <svg
        class="v-logo"
        width="48"
        height="48"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M5 3L12 21L19 3H15L12 10L9 3H5Z" fill="#365314" />
        <!-- lime-950 -->
      </svg>
    </div>

    <div
      class="relative flex min-h-screen flex-col items-center justify-center py-6 sm:py-12 px-4"
    >
      <div
        class="fade-in relative w-full max-w-3xl mx-auto rounded-xl bg-white bg-opacity-95 backdrop-blur-sm px-6 pt-10 pb-8 shadow-2xl ring-1 ring-gray-900/5 sm:px-10"
      >
        <div class="w-full">
          <div class="text-center mb-10">
            <h1 class="text-5xl font-extrabold text-lime-950 tracking-tight">
              Vanam AI Post Generator
            </h1>
            <p class="mt-4 text-lg text-lime-800 leading-relaxed">
              An exquisite Generative AI project to craft new LinkedIn posts in
              your unique, influential style.
            </p>
          </div>
          <div class="mt-10 space-y-8">
            <!-- Section 1: Input Past Posts -->
            <div
              class="bg-lime-50 p-6 rounded-lg shadow-inner ring-1 ring-lime-100 transition-all duration-300 hover:ring-lime-200"
            >
              <label
                for="style-examples"
                class="block text-xl font-semibold leading-8 text-lime-900 mb-2"
              >
                1. Define Your Voice
              </label>
              <p class="text-sm text-lime-700 mb-4">
                Provide examples of your best past posts. Our AI will
                meticulously learn your tone, vocabulary, and structure.
              </p>
              <textarea
                id="style-examples"
                name="style-examples"
                rows="10"
                class="block w-full rounded-md border-lime-200 p-4 text-gray-900 shadow-sm focus:ring-lime-500 focus:border-lime-500 sm:text-base transition-all duration-200 resize-y"
                placeholder="Example 1: 'Thrilled to announce our new funding round!...'&#10;&#10;Example 2: 'Productivity isn't about doing more, it's about...'&#10;&#10;Example 3: 'A quick tip for junior developers: always...'"
              >
Thrilled to announce our Series B funding! This is a testament to the hard work of our incredible team. We're on a mission to revolutionize the industry, and this is just the beginning. #startup #funding #tech

Productivity hack: I block 90 minutes of 'deep work' every morning. No emails, no meetings. Just pure focus. It's been a game-changer for my output. How do you stay focused? #productivity #worklife #focus

Networking is a superpower. Had a great time connecting with industry leaders at the #FutureTech summit. The main takeaway? AI is evolving faster than we think. We must adapt. #AI #networking #futureofwork
                        </textarea
              >
            </div>

            <!-- Section 2: Input New Topic -->
            <div
              class="bg-lime-50 p-6 rounded-lg shadow-inner ring-1 ring-lime-100 transition-all duration-300 hover:ring-lime-200"
            >
              <label
                for="new-topic"
                class="block text-xl font-semibold leading-8 text-lime-900 mb-2"
              >
                2. Inspire a New Post
              </label>
              <p class="text-sm text-lime-700 mb-4">
                What captivating topic should your next post be about? Type one
                below, or let us suggest topics based on your voice.
              </p>

              <!-- NEW: Suggest Topics Button and Loader -->
              <div class="mt-4 mb-4">
                <button
                  id="suggest-topics-btn"
                  type="button"
                  class="flex items-center justify-center gap-2 rounded-md bg-lime-200 px-4 py-2 text-sm font-semibold text-lime-800 shadow-sm hover:bg-lime-300 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-lime-600 transition-all duration-300 ease-in-out"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="lucide lucide-lightbulb"
                  >
                    <path
                      d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1.3.5 2.6 1.5 3.5.7.8 1.3 1.5 1.5 2.5"
                    />
                    <path d="M9 18h6" />
                    <path d="M10 22h4" />
                  </svg>
                  <span>Suggest Topics for Me</span>
                </button>
                <!-- NEW: Topic Loader (smaller) -->
                <div
                  id="topic-loader"
                  class="flex items-center justify-center py-2 space-y-2"
                  style="display: none"
                >
                  <div
                    class="spinner-container"
                    style="width: 32px; height: 32px"
                  >
                    <div class="spinner-ring" style="border-width: 3px"></div>
                    <svg
                      class="spinner-logo"
                      style="width: 16px; height: 16px"
                      viewBox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path d="M5 3L12 21L19 3H15L12 10L9 3H5Z" />
                    </svg>
                  </div>
                  <span class="ml-2 text-sm font-medium text-lime-700"
                    >Finding inspiration...</span
                  >
                </div>
              </div>

              <!-- NEW: Topic Suggestions Container -->
              <div
                id="topic-suggestions"
                class="flex flex-wrap gap-2 mt-4"
                style="display: none"
              >
                <!-- Suggested topic buttons will be inserted here by JavaScript -->
              </div>

              <input
                type="text"
                name="new-topic"
                id="new-topic"
                class="block w-full rounded-md border-lime-200 p-4 text-gray-900 shadow-sm focus:ring-lime-500 focus:border-lime-500 sm:text-base transition-all duration-200 mt-4"
                placeholder="e.g., 'The importance of work-life balance for remote teams'"
                value="The importance of mentorship in career growth"
              />
            </div>

            <!-- NEW: Section 3: Refine Your Post (Length & Tone) -->
            <div
              class="bg-lime-50 p-6 rounded-lg shadow-inner ring-1 ring-lime-100 transition-all duration-300 hover:ring-lime-200"
            >
              <label
                class="block text-xl font-semibold leading-8 text-lime-900 mb-2"
              >
                3. Refine Your Post
              </label>
              <p class="text-sm text-lime-700 mb-4">
                Set the desired length and tone for your new post.
              </p>

              <div class="space-y-4">
                <!-- Post Length Options -->
                <div>
                  <label class="text-sm font-medium text-lime-800"
                    >Post Length</label
                  >
                  <fieldset class="mt-2">
                    <legend class="sr-only">Post Length</legend>
                    <div class="flex flex-wrap gap-3">
                      <!-- Radio 1: Short -->
                      <div>
                        <input
                          type="radio"
                          name="post-length"
                          id="length-short"
                          value="Short (1-2 sentences)"
                          class="sr-only peer"
                          checked
                        />
                        <label
                          for="length-short"
                          class="flex cursor-pointer items-center justify-center rounded-md border border-lime-200 bg-white px-3 py-2 text-sm font-medium text-lime-900 shadow-sm hover:bg-lime-50 peer-checked:border-lime-600 peer-checked:bg-lime-100 peer-checked:ring-1 peer-checked:ring-lime-600"
                        >
                          <span>Short</span>
                        </label>
                      </div>
                      <!-- Radio 2: Intermediate -->
                      <div>
                        <input
                          type="radio"
                          name="post-length"
                          id="length-intermediate"
                          value="Intermediate (1-2 paragraphs)"
                          class="sr-only peer"
                        />
                        <label
                          for="length-intermediate"
                          class="flex cursor-pointer items-center justify-center rounded-md border border-lime-200 bg-white px-3 py-2 text-sm font-medium text-lime-900 shadow-sm hover:bg-lime-50 peer-checked:border-lime-600 peer-checked:bg-lime-100 peer-checked:ring-1 peer-checked:ring-lime-600"
                        >
                          <span>Intermediate</span>
                        </label>
                      </div>
                      <!-- Radio 3: Full Long Text -->
                      <div>
                        <input
                          type="radio"
                          name="post-length"
                          id="length-long"
                          value="Full Long Text (3+ paragraphs)"
                          class="sr-only peer"
                        />
                        <label
                          for="length-long"
                          class="flex cursor-pointer items-center justify-center rounded-md border border-lime-200 bg-white px-3 py-2 text-sm font-medium text-lime-900 shadow-sm hover:bg-lime-50 peer-checked:border-lime-600 peer-checked:bg-lime-100 peer-checked:ring-1 peer-checked:ring-lime-600"
                        >
                          <span>Full Long Text</span>
                        </label>
                      </div>
                    </div>
                  </fieldset>
                </div>

                <!-- Post Tone Options -->
                <div>
                  <label class="text-sm font-medium text-lime-800"
                    >Post Tone</label
                  >
                  <fieldset class="mt-2">
                    <legend class="sr-only">Post Tone</legend>
                    <div class="flex flex-wrap gap-3">
                      <!-- Radio 1: Default -->
                      <div>
                        <input
                          type="radio"
                          name="post-tone"
                          id="tone-default"
                          value="Default (Match my style)"
                          class="sr-only peer"
                          checked
                        />
                        <label
                          for="tone-default"
                          class="flex cursor-pointer items-center justify-center rounded-md border border-lime-200 bg-white px-3 py-2 text-sm font-medium text-lime-900 shadow-sm hover:bg-lime-50 peer-checked:border-lime-600 peer-checked:bg-lime-100 peer-checked:ring-1 peer-checked:ring-lime-600"
                        >
                          <span>Default (Match Style)</span>
                        </label>
                      </div>
                      <!-- Radio 2: Formal -->
                      <div>
                        <input
                          type="radio"
                          name="post-tone"
                          id="tone-formal"
                          value="More Formal"
                          class="sr-only peer"
                        />
                        <label
                          for="tone-formal"
                          class="flex cursor-pointer items-center justify-center rounded-md border border-lime-200 bg-white px-3 py-2 text-sm font-medium text-lime-900 shadow-sm hover:bg-lime-50 peer-checked:border-lime-600 peer-checked:bg-lime-100 peer-checked:ring-1 peer-checked:ring-lime-600"
                        >
                          <span>More Formal</span>
                        </label>
                      </div>
                      <!-- Radio 3: Casual -->
                      <div>
                        <input
                          type="radio"
                          name="post-tone"
                          id="tone-casual"
                          value="More Casual"
                          class="sr-only peer"
                        />
                        <label
                          for="tone-casual"
                          class="flex cursor-pointer items-center justify-center rounded-md border border-lime-200 bg-white px-3 py-2 text-sm font-medium text-lime-900 shadow-sm hover:bg-lime-50 peer-checked:border-lime-600 peer-checked:bg-lime-100 peer-checked:ring-1 peer-checked:ring-lime-600"
                        >
                          <span>More Casual</span>
                        </label>
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>

            <!-- Generate Button -->
            <div>
              <button
                id="generate-btn"
                type="button"
                class="flex w-full items-center justify-center gap-3 rounded-md bg-lime-700 px-4 py-3 text-lg font-semibold text-white shadow-lg hover:bg-lime-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-lime-600 transition-all duration-300 ease-in-out transform hover:scale-105"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-sparkles"
                >
                  <path
                    d="M9.9 10.4 7.6 13.1c-.8.8-1.7 2-2.3 3.4a.5.5 0 0 0 .4.8c1.6.4 3.3-.2 4.2-1.2l2.7-2.3"
                  />
                  <path
                    d="M12.4 12.6 14.7 9.9c.8-.8 1.7-2 2.3-3.4a.5.5 0 0 0-.4-.8c-1.6-.4-3.3.2-4.2 1.2l-2.7 2.3"
                  />
                </svg>
                <span>Generate Elite Post</span>
              </button>
              <!-- NEW Loader Structure -->
              <div
                id="loader"
                class="flex flex-col items-center justify-center py-4 space-y-2"
                style="display: none"
              >
                <div class="spinner-container">
                  <div class="spinner-ring"></div>
                  <svg
                    class="spinner-logo"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path d="M5 3L12 21L19 3H15L12 10L9 3H5Z" />
                  </svg>
                </div>
                <span class="text-sm font-medium text-lime-700"
                  >Generating...</span
                >
              </div>
            </div>

            <!-- Error Message Box -->
            <div
              id="error-box"
              class="rounded-lg bg-red-50 p-4 ring-1 ring-red-200"
              style="display: none"
            >
              <div class="flex items-start">
                <div class="flex-shrink-0">
                  <svg
                    class="h-6 w-6 text-red-600"
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                    aria-hidden="true"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </div>
                <div class="ml-3">
                  <h3
                    id="error-message"
                    class="text-base font-medium text-red-900"
                  >
                    An unexpected error occurred.
                  </h3>
                </div>
              </div>
            </div>

            <!-- Output Section -->
            <div
              id="output-section"
              class="bg-lime-50 p-6 rounded-lg shadow-inner ring-1 ring-lime-100"
              style="display: none"
            >
              <div class="flex justify-between items-center mb-4">
                <label
                  for="generated-post"
                  class="block text-xl font-semibold leading-8 text-lime-900"
                >
                  4. Your Crafted Post
                </label>
                <div class="flex items-center gap-3">
                  <button
                    id="copy-btn"
                    type="button"
                    class="flex items-center gap-2 rounded-md bg-gray-200 px-3 py-2 text-sm font-medium text-gray-800 hover:bg-gray-300 transition-all duration-200"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-clipboard"
                    >
                      <rect
                        width="8"
                        height="4"
                        x="8"
                        y="2"
                        rx="1"
                        ry="1"
                      ></rect>
                      <path
                        d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
                      ></path>
                    </svg>
                    <span id="copy-text">Copy</span>
                  </button>
                  <button
                    id="pdf-btn"
                    type="button"
                    class="flex items-center gap-2 rounded-md bg-lime-200 px-3 py-2 text-sm font-medium text-lime-800 hover:bg-lime-300 transition-all duration-200"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-download"
                    >
                      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                      <polyline points="7 10 12 15 17 10" />
                      <line x1="12" x2="12" y1="15" y2="3" />
                    </svg>
                    <span>Download PDF</span>
                  </button>
                </div>
              </div>
              <textarea
                id="generated-post"
                name="generated-post"
                rows="12"
                class="block w-full rounded-md border-lime-200 p-4 text-gray-900 shadow-sm read-only:bg-lime-100 sm:text-base resize-y"
                readonly
              ></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // --- UPDATED: Groq API Configuration ---
      // Using a fast, supported model from Groq
      const MODEL_NAME = "llama-3.1-8b-instant";

      // !! IMPORTANT !!
      // You must paste your Groq API key here.
      // Get your key from: https://console.groq.com/keys
      const API_KEY = ""; // <-- PASTE YOUR GROQ API KEY HERE

      // Groq's API endpoint (mimics OpenAI's)
      const API_URL = "https://api.groq.com/openai/v1/chat/completions";

      const { jsPDF } = window.jspdf;

      // --- DOM Elements ---
      const generateBtn = document.getElementById("generate-btn");
      const loader = document.getElementById("loader");
      const outputSection = document.getElementById("output-section");
      const errorBox = document.getElementById("error-box");
      const errorMessage = document.getElementById("error-message");
      const generatedPost = document.getElementById("generated-post");
      const copyBtn = document.getElementById("copy-btn");
      const copyText = document.getElementById("copy-text");
      const pdfBtn = document.getElementById("pdf-btn");
      const mainContent = document.querySelector(".fade-in"); // Select the main content div for animation

      // --- NEW: Topic Suggestion DOM Elements ---
      const suggestTopicsBtn = document.getElementById("suggest-topics-btn");
      const topicLoader = document.getElementById("topic-loader");
      const topicSuggestions = document.getElementById("topic-suggestions");
      const newTopicInput = document.getElementById("new-topic");

      // --- Initial Load Animation ---
      document.addEventListener("DOMContentLoaded", () => {
        mainContent.style.opacity = "0"; // Ensure it starts invisible
        mainContent.style.transform = "translateY(20px)";
        setTimeout(() => {
          mainContent.style.opacity = "1";
          mainContent.style.transform = "translateY(0)";
        }, 100); // Small delay to ensure CSS is applied before animation
      });

      // --- Event Listeners ---
      generateBtn.addEventListener("click", handleGenerateClick);
      copyBtn.addEventListener("click", handleCopyClick);
      pdfBtn.addEventListener("click", handleDownloadPDF);

      // --- NEW: Topic Suggestion Event Listener ---
      suggestTopicsBtn.addEventListener("click", handleSuggestTopics);

      // --- Core Functions ---

      /**
       * --- UPDATED for Groq ---
       * Handles the "Suggest Topics" button click.
       * Calls the AI to get topic ideas based on the style examples.
       */
      async function handleSuggestTopics() {
        const styleExamples = document.getElementById("style-examples").value;

        if (!API_KEY) {
          showError(
            "API key is missing. Please add your Groq API key to the index.html file (line 304)."
          );
          return;
        }

        if (!styleExamples.trim()) {
          showError(
            "Please define your voice in Section 1 first so I can suggest relevant topics."
          );
          return;
        }

        // Show loader, hide old suggestions
        suggestTopicsBtn.style.display = "none";
        topicLoader.style.display = "flex";
        topicSuggestions.style.display = "none";
        hideError();

        try {
          // 1. Construct the System and User Prompts for Groq
          const systemPrompt = `
You are an expert LinkedIn content strategist. Your job is to analyze a user's past posts and suggest 3 new, relevant, and engaging post topics that match their style and themes.

**RULES:**
- Analyze the "PAST POSTS" to identify key themes (e.g., #productivity, #tech, #leadership).
- Generate 3 short, distinct post topics based on these themes.
- Output *only* a valid JSON object with a single key "topics" which holds an array of 3 strings.
- Do NOT add any other text, just the JSON object.
- Example: {"topics": ["The future of AI in startups", "My top 3 productivity hacks for remote work", "Why mentorship is a non-negotiable for career growth"]}
                `;

          const userQuery = `
Here are the user's past posts:
---
${styleExamples}
---

Suggest 3 new topics as a JSON object:
                `;

          // 2. Call the Groq API with JSON response format
          const payload = {
            model: MODEL_NAME,
            messages: [
              { role: "system", content: systemPrompt },
              { role: "user", content: userQuery },
            ],
            response_format: { type: "json_object" }, // Request JSON output
          };

          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${API_KEY}`, // Use Bearer token for Groq
            },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(
              errorData.error?.message || "An unknown API error occurred."
            );
          }

          const result = await response.json();
          // Groq's response structure is different
          const text = result.choices?.[0]?.message?.content;

          if (!text) {
            throw new Error("AI did not return any topic suggestions.");
          }

          // 3. Parse the JSON response
          const parsedData = JSON.parse(text); // This should be an object {"topics": ["..."]}
          const topics = parsedData.topics;

          // 4. Populate the suggestion buttons
          topicSuggestions.innerHTML = ""; // Clear old suggestions
          if (topics && topics.length > 0) {
            topics.forEach((topic) => {
              const btn = document.createElement("button");
              btn.type = "button";
              btn.textContent = topic;
              // Apply Tailwind classes
              btn.className =
                "px-3 py-1.5 bg-lime-100 text-lime-800 rounded-lg text-sm font-medium hover:bg-lime-200 transition-all shadow-sm";
              // Add click event to populate the main input field
              btn.onclick = () => {
                newTopicInput.value = topic;
              };
              topicSuggestions.appendChild(btn);
            });
            topicSuggestions.style.display = "flex";
          } else {
            throw new Error("AI returned an empty list of topics.");
          }
        } catch (error) {
          console.error("Error suggesting topics:", error);
          showError(error.message);
        } finally {
          // Hide loader and show the button again
          suggestTopicsBtn.style.display = "flex";
          topicLoader.style.display = "none";
        }
      }

      /**
       * --- UPDATED for Groq ---
       * Main function to handle the "Generate" button click.
       */
      async function handleGenerateClick() {
        if (!API_KEY) {
          showError(
            "API key is missing. Please add your Groq API key to the index.html file (line 304)."
          );
          return;
        }

        // 1. Get and validate inputs
        const styleExamples = document.getElementById("style-examples").value;
        const newTopic = document.getElementById("new-topic").value;

        // NEW: Get Length and Tone values
        const selectedLength = document.querySelector(
          'input[name="post-length"]:checked'
        ).value;
        const selectedTone = document.querySelector(
          'input[name="post-tone"]:checked'
        ).value;

        if (!styleExamples.trim() || !newTopic.trim()) {
          showError(
            "Please fill in all fields: your past posts, a new topic, and refinement options."
          );
          return;
        }

        // 2. Update UI (show loader, hide old results)
        setLoading(true);
        hideError();
        outputSection.style.display = "none"; // Hide output before new generation

        try {
          // 3. Construct the System Instruction and User Prompt for Groq
          const systemPrompt = `
You are an expert LinkedIn influencer and ghostwriter. Your task is to write a new LinkedIn post for a client.
You must analyze the client's writing style from the examples they provide and then write a new post on their chosen topic.

**RULES:**
- Analyze the "WRITING STYLE EXAMPLES" to understand the client's voice.
- Write a new post on the "NEW POST TOPIC".
- **Length Constraint:** The post must be approximately the requested **NEW POST LENGTH**: "${selectedLength}".
- **Tone Constraint:** The post's tone must adhere to the **NEW POST TONE**: "${selectedTone}". If 'Default (Match my style)' is chosen, strictly mimic the style examples. If 'More Formal' or 'More Casual' is chosen, adjust the style accordingly.
- Match the style, formatting (e.g., line breaks, lists), vocabulary, and use of hashtags/emojis as closely as possible, while respecting the new tone and length constraints.
- Do NOT add any extra commentary. Only output the new post.
                `;

          const userQuery = `
Here is the information from the client.

**WRITING STYLE EXAMPLES:**
---
${styleExamples}
---

**NEW POST TOPIC:**
---
${newTopic}
---

**GENERATED POST:**
                `;

          // 4. Call the Groq API
          const payload = {
            model: MODEL_NAME,
            messages: [
              { role: "system", content: systemPrompt },
              { role: "user", content: userQuery },
            ],
          };

          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${API_KEY}`, // Use Bearer token for Groq
            },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(
              errorData.error?.message || "An unknown API error occurred."
            );
          }

          const result = await response.json();
          // Groq's response structure is different
          const text = result.choices?.[0]?.message?.content;

          if (!text) {
            throw new Error("Received an empty response from the AI.");
          }

          // 5. Display the result
          generatedPost.value = text.trim();
          outputSection.style.display = "block";
          // Add class for slide-up-fade-in animation
          outputSection.classList.add("slide-up-fade-in");
        } catch (error) {
          console.error("Error generating post:", error);
          showError(error.message);
        } finally {
          // 6. Hide loader
          setLoading(false);
        }
      }

      /**
       * Copies the generated post text to the clipboard.
       */
      function handleCopyClick() {
        generatedPost.select();
        generatedPost.setSelectionRange(0, 99999); // For mobile devices
        try {
          document.execCommand("copy");
          copyText.textContent = "Copied!";
          copyBtn.classList.add("bg-green-100", "text-green-800"); // Optional: visual feedback
          setTimeout(() => {
            copyText.textContent = "Copy";
            copyBtn.classList.remove("bg-green-100", "text-green-800");
          }, 2000);
        } catch (err) {
          console.error("Failed to copy text: ", err);
          showError("Failed to copy text. Please copy manually.");
        }
      }

      /**
       * Generates and downloads a PDF of the generated post.
       */
      function handleDownloadPDF() {
        const postText = generatedPost.value;
        if (!postText.trim()) {
          showError("Nothing to download. Please generate a post first.");
          return;
        }

        try {
          const doc = new jsPDF();
          doc.setFont("Inter", "normal"); // Use Inter font for PDF
          doc.setFontSize(12);
          const margin = 15;
          const usableWidth = doc.internal.pageSize.getWidth() - 2 * margin;

          doc.setFontSize(16);
          doc.setFont("Playfair Display", "bold"); // Use Playfair for PDF title
          doc.text("Vanam AI Generated Post", margin, 20);

          doc.setFontSize(12);
          doc.setFont("Inter", "normal"); // Back to Inter for body
          doc.text(postText, margin, 35, { maxWidth: usableWidth });

          doc.save("vanam-ai-post.pdf");
        } catch (err) {
          console.error("Failed to generate PDF: ", err);
          showError("An error occurred while generating the PDF.");
        }
      }

      // --- UI Helper Functions ---

      /**
       * Toggles the loading state of the generate button.
       * @param {boolean} isLoading - Whether to show the loader.
       */
      function setLoading(isLoading) {
        if (isLoading) {
          generateBtn.style.display = "none";
          loader.style.display = "flex";
          outputSection.classList.remove("slide-up-fade-in"); // Remove animation class when loading
        } else {
          generateBtn.style.display = "flex";
          loader.style.display = "none";
        }
      }

      /**
       * Displays an error message to the user.
       * @param {string} message - The error message to show.
       */
      function showError(message) {
        errorMessage.textContent = message;
        errorBox.style.display = "block";
        errorBox.classList.add("fade-in"); // Animate error message
      }

      /**
       * Hides the error message box.
       */
      function hideError() {
        errorBox.style.display = "none";
        errorBox.classList.remove("fade-in");
      }
    </script>
  </body>
</html>
